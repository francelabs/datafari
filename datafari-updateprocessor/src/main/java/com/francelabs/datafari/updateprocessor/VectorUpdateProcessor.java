/*******************************************************************************
 /*******************************************************************************
 *  * Copyright 2020 France Labs
 *  *
 *  * Licensed under the Apache License, Version 2.0 (the "License");
 *  * you may not use this file except in compliance with the License.
 *  * You may obtain a copy of the License at
 *  *
 *  *      http://www.apache.org/licenses/LICENSE-2.0
 *  *
 *  * Unless required by applicable law or agreed to in writing, software
 *  * distributed under the License is distributed on an "AS IS" BASIS,
 *  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 *  * See the License for the specific language governing permissions and
 *  * limitations under the License.
 *******************************************************************************/
package com.francelabs.datafari.updateprocessor;

import java.io.IOException;

import java.util.Arrays;
import java.util.List;
import java.util.regex.Matcher;
import java.util.regex.Pattern;

import dev.langchain4j.data.document.Document;
import dev.langchain4j.data.document.DocumentSplitter;
import dev.langchain4j.data.document.splitter.DocumentByParagraphSplitter;

import dev.langchain4j.data.segment.TextSegment;


import dev.langchain4j.model.Tokenizer;
import dev.langchain4j.model.openai.OpenAiTokenizer;
import org.apache.logging.log4j.LogManager;
import org.apache.logging.log4j.Logger;
import org.apache.solr.client.solrj.SolrServerException;
import org.apache.solr.client.solrj.impl.CloudSolrClient;
import org.apache.solr.common.SolrInputDocument;
import org.apache.solr.common.SolrInputField;
import org.apache.solr.common.params.SolrParams;
import org.apache.solr.update.AddUpdateCommand;
import org.apache.solr.update.DeleteUpdateCommand;
import org.apache.solr.update.processor.UpdateRequestProcessor;
import org.json.simple.JSONArray;
import org.json.simple.JSONObject;

public class VectorUpdateProcessor extends UpdateRequestProcessor {
  private static final Logger LOGGER = LogManager.getLogger(VectorUpdateProcessor.class.getName());
  boolean enabled = false;
  CloudSolrClient client;

  private static final int CHUNK_SIZE = 4000;
  private static final int MAX_OVERLAP_SIZE = 100;
  private static final int VECTOR_DIMENSION = 4;

  public VectorUpdateProcessor(CloudSolrClient client, final SolrParams params, final UpdateRequestProcessor next) {
    super(next);
    if (params != null) {
      this.enabled = params.getBool("enabled", false);
      this.client = client;
    }
  }

  @Override
  public void processAdd(final AddUpdateCommand cmd) throws IOException {
    if (enabled) {
      final SolrInputDocument parentDoc = cmd.getSolrInputDocument();

      String content = "";
      String parentId = (String) parentDoc.get("id").getValue();
      final SolrInputField contentFieldFr = parentDoc.get("content_fr");
      final SolrInputField contentFieldEn = parentDoc.get("content_en");
      if (contentFieldFr != null) {
        content = (String) contentFieldFr.getFirstValue();
      } else if (contentFieldEn != null) {
        content = (String) contentFieldEn.getFirstValue();
      }

      deleteExistingChildren(parentId);

      if (content != null && !content.isEmpty()) {

        // Chunking
        Tokenizer tokenizer = new OpenAiTokenizer();
        DocumentSplitter splitter = new DocumentByParagraphSplitter(CHUNK_SIZE, MAX_OVERLAP_SIZE, tokenizer);
        Document document = new Document(content);
        List<TextSegment> chunks = splitter.split(document);

        for (TextSegment chunk : chunks) {
          if(chunk != null && !chunk.text().isEmpty()) {

            // Vector embeddings
            List<Float> vector = vectorEmbeddings(chunk.text());

            // Sub-document creation
            if (chunk.text() != null && vector.size() == VECTOR_DIMENSION) {

              SolrInputDocument vectorDocument = parentDoc.deepCopy();
              String vectorField = "vector_1536";
              List<Float> floatvector;

              // TODO : Remove this test
              if (parentId.contains("calendriers")) {
                // The black dog name is Olive.
                floatvector =  Arrays.asList(0.05430203F, -0.04516164F, -0.033004466F, -0.016265843F, -0.03111335F, -0.006421913F, 0.015579189F, 0.00024694254F, -0.0046264785F, -0.0427302F, 0.033657353F, 0.023571402F, 0.0039510806F, -0.019248853F, 0.015185206F, -0.0010229471F, -0.021590235F, 0.0335673F, -0.02987512F, 0.033184573F, 0.011684392F, 0.012078374F, -0.032103937F, 0.020655934F, 0.028074058F, -0.034017563F, 0.011954551F, -0.029289776F, 0.036966804F, 0.011684392F, 0.013924463F, -0.034445316F, 0.030888218F, 0.0067202137F, 0.008994055F, -0.044171054F, -0.02595781F, -0.003433275F, 0.016975012F, 0.036921777F, -0.030595547F, -0.021500181F, 0.02471958F, 0.0038160007F, 0.017425278F, 0.008752037F, 0.021038659F, -0.00027367705F, 0.0671346F, -0.002342788F, 0.0629021F, 0.023954129F, 0.00753632F, -0.028344218F, 0.008847718F, -0.045746982F, -0.011481772F, 0.050024506F, 0.048853815F, -0.033657353F, -0.03482804F, -0.020712215F, 0.030302873F, -0.03404008F, 0.0065401075F, -0.02254705F, 0.0070860544F, 0.0063600014F, -0.010795117F, -0.041762132F, -0.0034445317F, 0.0074406387F, -0.0053300187F, 0.029424855F, 0.03599873F, 0.011104675F, -0.0023456023F, -0.037304502F, 0.018033136F, -0.014037029F, 0.0052033816F, 0.04385587F, -0.0067370986F, -0.053266417F, 0.0664592F, -0.018674765F, -0.03460291F, -0.011819472F, -0.012945135F, 0.0077220546F, 0.0052765496F, -0.04079406F, -0.0031068325F, -0.0328919F, 0.021083685F, 0.021500181F, 0.027848925F, -0.025800217F, -0.0030224076F, -0.0094555775F, -0.058039233F, -0.042685177F, 0.028029032F, 0.006039187F, -0.05975024F, -0.00897717F, 0.03694429F, -0.032351583F, -0.037304502F, -0.005673346F, -0.08208341F, -0.0018756376F, 0.035075687F, 0.007874019F, -0.0031237174F, -0.018978694F, 0.019811686F, 0.02026195F, 0.010069064F, -0.067449786F, -0.019068748F, 0.07677028F, 0.014318445F, -0.023031084F, -0.028321704F, 0.04056893F, -0.0025735493F, 0.030798165F, -0.035030663F, -0.03885792F, -0.012967649F, -0.012539896F, 0.0039398237F, 0.022828465F, -0.005451028F, 0.0027212927F, -0.015387826F, -0.021511437F, 0.004300036F, 0.0322165F, -0.004046762F, -0.044306133F, -0.006269948F, -0.018674765F, -0.004474514F, 0.0031800007F, -0.041582026F, 0.000029196908F, 0.012618693F, -0.07073672F, 0.02917721F, -0.0058309394F, -0.021815367F, 0.0010778232F, 0.0046264785F, 0.03487307F, 0.01909126F, -0.008099152F, -0.044126026F, 0.016637312F, -0.0150051005F, -0.03151859F, 0.009517489F, 0.023503862F, -0.0090559665F, 0.04387838F, 0.012787542F, 0.01503887F, -0.014340959F, 0.0169525F, 0.061281145F, 0.039510805F, 0.03302698F, 0.007941559F, -0.040456362F, -0.03658408F, 0.06366755F, 0.051375303F, -0.050699905F, -0.004547682F, -0.027015934F, 0.07501424F, -0.0036330803F, -0.002572142F, -0.05038472F, -0.011954551F, 0.033905F, 0.023076111F, -0.007412497F, 0.046107195F, 0.002446912F, 0.028029032F, 0.032374095F, -0.030798165F, 0.011059648F, 0.028344218F, 0.0072380193F, -0.02217558F, -0.023076111F, -0.0077558244F, 0.035683546F, 0.028366731F, -0.031946342F, -0.033905F, 0.027015934F, 0.0076488866F, -0.05754394F, -0.034242697F, -0.0074068685F, -0.031158378F, 0.03118089F, -0.030685598F, -0.019102518F, -0.008256745F, -0.01614202F, 0.01376687F, 0.030167794F, -0.0013465754F, -0.0071929926F, 0.02870443F, -0.020374518F, 0.0026340536F, 0.023391297F, -0.021657774F, -0.037304502F, 0.03570606F, 0.04381084F, -0.007429382F, 0.01095271F, -0.028389245F, 0.029942662F, 0.022265632F, 0.0060617F, -0.0042156116F, 0.014577348F, -0.036989316F, -0.018505914F, 0.011329807F, -0.010446161F, -0.027173527F, -0.028276678F, 0.0036837352F, 0.014194623F, 0.05884971F, -0.036088787F, -0.0037991158F, 0.04331555F, -0.029244749F, -0.07046656F, 0.04642238F, -0.0022991686F, 0.018010624F, 0.010018409F, -0.051330276F, -0.013012675F, -0.012686232F, -0.035616007F, -0.03014528F, -0.0606958F, 0.011932038F, 0.013913206F, -0.043608222F, -0.017695436F, -0.0023132393F, -0.045521848F, -0.012866339F, 0.039308183F, 0.019834198F, -0.023593916F, 0.019642835F, -0.013834409F, 0.020475827F, 0.0012304914F, 0.01631087F, -0.029762555F, 0.00015513056F, -0.024156747F, 0.005566408F, 0.025687652F, -0.039916042F, -0.042910308F, 0.03302698F, 0.016806163F, -0.013113985F, 0.05898479F, 0.016130764F, -0.02562011F, -0.010502445F, 0.0003725244F, 0.03165367F, 0.038497705F, -0.008678869F, -0.005211824F, 0.020081844F, -0.025057279F, -0.037934873F, -0.009945241F, 0.006343116F, 0.029244749F, -0.027781386F, 0.07127704F, -0.00073168153F, -0.0023610801F, -0.031248432F, -0.04655746F, 0.010254798F, 0.0026368678F, -0.030460466F, -0.0057915407F, -0.048178416F, -0.01919257F, 0.011160958F, -0.009979011F, 0.02334627F, -0.0020473013F, -0.043293037F, 0.024494447F, 0.03694429F, -0.019530268F, -0.014352215F, -0.0033572926F, -0.014644888F, 0.0077051697F, 0.05844447F, -0.05178054F, 0.015522906F, -0.01829204F, -0.041762132F, 0.018427119F, 0.004139629F,
                        -0.026363049F, -0.024291828F, 0.004578638F, 0.05308631F, -0.03919562F, -0.042595122F, -0.084920086F, -0.037056856F, -0.003990479F, 0.009877701F, -0.04907895F, -0.03926316F, -0.034175158F, 0.00901094F, -0.018663509F, -0.0051921248F, 0.042685177F, 0.022952288F, -0.026790801F, 0.035390873F, -0.015399083F, -0.0009786241F, -0.003295381F, 0.0023498235F, -0.013721843F, 0.019271366F, -0.042910308F, -0.023413809F, -0.041987266F, 0.05430203F, 0.022468252F, 0.042595122F, -0.024089208F, -0.01637841F, 0.048088364F, -0.035053175F, 0.0030702483F, -0.023053598F, 0.0021795668F, 0.029852608F, -0.0049923197F, 0.0630822F, 0.0010637525F, 0.0047109034F, -0.03007774F, 0.05362663F, -0.023999155F, 0.0425501F, -0.02465204F, 0.014239648F, 0.020791013F, 0.033950023F, 0.0124611F, -0.024179261F, -0.016975012F, -0.02354889F, -0.030955758F, -0.019271366F, -0.008982798F, 0.0008787214F, 0.01785303F, -0.035818625F, 0.010569984F, -0.0040777177F, -0.042842768F, -0.026610695F, -0.055877957F, 0.017177632F, -0.031676184F, 0.012697489F, 0.015984427F, -0.039735936F, -0.042820256F, -0.020824783F, -0.0335673F, -0.017537843F, -0.0001318258F, -0.016130764F, 0.011650622F, 0.029402342F, 0.06461311F, -0.028029032F, 0.041154273F, -0.017368995F, -0.0010700843F, 0.018179473F, 0.0147461975F, 0.003959523F, -0.0562832F, -0.003011151F, 0.028456785F, -0.039623372F, -0.012753773F, -0.008403081F, -0.006269948F, 0.028456785F, 0.08960285F, -0.033139545F, 0.029785067F, 0.026543155F, -0.012449843F, 0.034175158F, -0.0028901421F, 0.020543367F, 0.007761453F, -0.12112144F, -0.051420327F, 0.014115825F, -0.02917721F, -0.02026195F, -0.024404394F, -0.006590762F, 0.038610272F, -0.0121008875F, -0.028119085F, 0.008481878F, 0.031496078F, 0.00065605104F, 0.009995895F, 0.010800745F, -0.021522695F, -0.019890482F, -0.022558305F, 0.04435116F, 0.029942662F, -0.039938558F, 0.0075588333F, 0.01644595F, 0.0354359F, -0.01871979F, 0.016164534F, -0.008369312F, 0.010727577F, 0.020160642F, 0.050249636F, -0.010136603F, -0.051735513F, 0.033139545F, 0.03845268F, -0.0012832569F, 0.05110514F, 0.020216925F, -0.011864498F, -0.017042551F, -0.008583187F, 0.010750091F, 0.0019389561F, 0.010997737F, -0.056688435F, 0.058534525F, -0.039848503F, 0.013755613F, 0.003697806F, -0.017200144F, 0.026205456F, -0.02944737F, 0.059254948F, -0.017830517F, -0.019912995F, 0.00619678F, 0.020003049F, 0.017087579F, 0.01524149F, -0.008228604F, -0.0012283807F, 0.06690946F, -0.0046518063F, -0.04572447F, 0.0053075054F, -0.0274662F, -0.0019234782F, 0.022220606F, 0.012224711F, 0.07321318F, 0.005543895F, -0.013260321F, 0.0114423735F, -0.033477247F, -0.010237914F, 0.0072661606F, 0.0009701816F, 0.031676184F, -0.03584114F, 0.0070860544F, -0.023166163F, -0.009663825F, 0.03399505F, -0.018708535F, -0.019586552F, 0.0102154F, 0.02773636F, 0.023864076F, 0.03007774F, -0.02787144F, -0.0004115709F, 0.015916888F, -0.004575824F, 0.030640572F, -0.011853241F, 0.030190306F, 0.0012171242F, -0.024494447F, -0.03358981F, 0.006534479F, -0.02944737F, 0.016006941F, 0.0047109034F, 0.009089736F, 0.010339223F, 0.0061855232F, -0.009967754F, -0.013823153F, 0.013676817F, 0.024021668F, 0.026970908F, -0.0027747615F, -0.014712428F, -0.0013409471F, 0.02059965F, 0.03996107F, 0.004333806F, 0.021094942F, 0.018415863F, -0.017481562F, 0.007007258F, 0.00482347F, -0.0058590807F, -0.030302873F, -0.008234232F, 0.02036326F, -0.026993422F, 0.016232073F, 0.00425501F, 0.02987512F, 0.002957682F, -0.018798588F, 0.03228404F, -0.003678107F, 0.002642496F, -0.010125347F, -0.013609277F, -0.004840355F, -0.0013515003F, 0.000062703F, 0.014442268F, 0.016929986F, 0.008628214F, 0.016671082F, -0.02231066F, -0.019890482F, -0.02321119F, -0.028366731F, -0.08311903F, -0.0025566642F, -0.005194939F, 0.015421595F, -0.027015934F, -0.021770341F, 0.013721843F, 0.0019178499F, 0.009213559F, -0.011239754F, -0.0038610273F, -0.033882484F, -0.028096572F, -0.017706694F, -0.0119658075F, -0.029222235F, 0.009748249F, -0.010766976F, -0.0014886905F, -0.012753773F, 0.033252113F, 0.06213665F, -0.036426485F, 0.012269737F, -0.033859972F, 0.0013613498F, 0.06677438F, 0.020216925F, -0.0040101777F, -0.0046574343F, -0.0025735493F, -0.023436323F, 0.025642624F, -0.0013986374F, -0.028929563F, -0.005020461F, -0.016119508F, -0.011538056F, -0.026182944F, -0.010085949F, 0.004012992F, -0.021083685F, -0.0278039F, 0.0001436101F, -0.0034192041F, -0.009624426F, -0.006326231F, -0.040366307F, 0.009928356F, -0.017143862F, 0.008082267F, 0.019203827F, 0.01524149F, 0.0057859127F, -0.030775651F, 0.0043225493F, 0.01651349F, 0.031968854F, -0.017470304F, 0.005335647F, 0.010046551F, 0.003607753F, 0.0347605F, -0.01741402F, 0.018010624F, 0.0347605F, -0.016558517F, -0.0042043547F, 0.002272434F, -0.063127235F, -0.011684392F, 0.017245172F, -0.007553205F, 0.012945135F, 0.016794905F, 0.012438587F, -0.024809632F, 0.009810161F, 0.008386197F, -0.027421173F, 0.0015942216F,
                        -0.016772393F, 0.0322165F, -0.008904002F, -0.029334802F, 0.020340748F, 0.019372676F, -0.03680921F, 0.05033969F, 0.0070860544F, 0.05295123F, 0.007271789F, 0.018460888F, 0.007305559F, -0.01678365F, -0.019215083F, -0.009095364F, 0.0047249743F, -0.010130975F, -0.0010940046F, -0.00820609F, -0.032936927F, 0.020802269F, -0.048223443F, -0.00046503992F, -0.049349107F, 0.0021049916F, -0.0150163565F, 0.011763188F, 0.008279258F, -0.0056114346F, -0.013091472F, 0.034175158F, 0.04324801F, 0.022704642F, -0.046287302F, 0.0037259476F, -0.04518415F, 0.031203404F, 0.005563594F, -0.033184573F, -0.021466412F, -0.027151015F, 0.011999577F, -0.035616007F, 0.002021974F, -0.01744779F, -0.010660037F, -0.012337277F, 0.006157382F, -0.03674167F, 0.022603331F, 0.023864076F, -0.00696786F, -0.0063093463F, -0.015309029F, -0.025800217F, 0.030392926F, 0.015342799F, 0.04002861F, -0.005808426F, -0.05740886F, 0.0242468F, -0.00978202F, 0.048448578F, -0.0015224605F, -0.009252957F, 0.011954551F, -0.007024143F, -0.006810267F, 0.017864287F, -0.0028648146F, -0.028006518F, -0.02097112F, -0.03606627F, -0.0065569924F, -0.011194727F, -0.038002413F, -0.016794905F, 0.019969279F, -0.017459048F, -0.019980535F, 0.025057279F, -0.0026340536F, -0.025597598F, -0.0071929926F, -0.044441212F, 0.010395506F, 0.02160149F, 0.006782125F, -0.04572447F, 0.026340537F, 0.0038891688F, -0.040816575F, 0.016457208F, 0.0058196825F, -0.0036387087F, 0.027623793F, 0.0043450627F, 0.014250905F, -0.017808003F, 0.03266677F, -0.009630055F, 0.03919562F, 0.03192383F, -0.009129135F, -0.005864709F, 0.02388659F, -0.02294103F, -0.05178054F, -0.028726943F, 0.00014325832F, 0.0008203276F, 0.017335225F, 0.028164111F, -0.020284465F, 0.00018292038F, -0.004156514F, 0.042887796F, -0.008549417F, 0.019980535F, -0.011684392F, 0.017278941F, -0.02602535F, 0.0017166375F, -0.019845456F, -0.018584711F, 0.008470621F, 0.0061404966F, -0.03118089F, 0.0005835864F, -0.029087156F, 0.032261528F, -0.023999155F, -0.021196252F, -0.063892685F, -0.01239356F, 0.031473562F, -0.009703223F, -0.009663825F, 0.022366943F,
                        0.007254904F, 0.0064725676F, -0.047548044F, 0.037259474F, -0.028952077F, 0.010327967F, 0.03199137F, -0.011898268F, 0.033477247F, -0.011887011F, 0.040749036F, 0.02773636F, -0.061956543F, 0.0065795057F, 0.013575507F, 0.017627897F, -0.0075081782F, 0.007496922F, -0.019924251F, -0.019147543F, -0.021826623F, -0.00018766928F, 0.046107195F, 0.0079978425F, 0.00612924F, -0.009787648F, 0.044891477F, 0.05191562F, 0.022670873F, -0.0037540891F, 0.003171558F, 0.022490766F, 0.0036724785F, -0.017864287F, 0.026430588F, -0.054347053F, -0.0080034705F, 0.020419544F, 0.022558305F, -0.007496922F, -0.032464147F, 0.005301877F, -0.03266677F, -0.007204249F, -0.0018207614F, -0.0012283807F, 0.031676184F, 0.01892241F, -0.018776074F, -0.042234913F, 0.020802269F, 0.012742516F, -0.041919723F, -0.0017110092F, -0.0118419845F, 0.026610695F, -0.007727683F, 0.0083974525F, -0.008442479F, -0.03597622F, -0.014093312F, 0.012517383F, 0.0066470457F, -0.0122359665F, 0.0043929033F, 0.008065382F, -0.0061123553F, -0.02388659F, -0.03219399F, -0.06591888F, 0.014701171F, 0.00964694F, -0.0016913101F, -0.042302452F, 0.0000047324056F, -0.0130239315F, -0.0033010095F, -0.0060673286F, -0.0053272047F, -0.014149596F, 0.017594127F, -0.02890705F, 0.030528005F, 0.017425278F, 0.042077318F, 0.008256745F, 0.0069734883F, -0.0036218236F, -0.037327018F, 0.025102306F, -0.008645099F, 0.0029914519F, -0.020768499F, 0.025304925F, -0.004294408F, -0.0076263733F, -0.051465355F, 0.021466412F, 0.024449421F, 0.0049388506F, -0.016254587F, -0.033049494F, 0.015230233F, -0.030235333F, 0.0017461862F, 0.019699119F, 0.010789488F, 0.022456996F, -0.03750712F, -0.011628108F, -0.018348321F, -0.01829204F, 0.021747828F, -0.018224498F, -0.0037569033F, 0.01390195F, 0.011369206F, 0.039916042F, 0.00870701F, -0.001760257F, 0.021961704F, -0.0050148326F, -0.04588206F, 0.024967225F, -0.00978202F, -0.00019646353F, -0.046197247F, 0.01215717F, -0.0498444F, -0.014194623F, -0.009905843F, 0.03075314F, -0.0029970803F, 0.013586763F, -0.0278039F, 0.02254705F, -0.014836251F, 0.02890705F, 0.0134179145F, 0.034647934F, -0.037687227F, -0.01741402F, -0.012010834F, -0.010992108F, 0.019867968F, -0.007935931F, -0.021252535F, -0.00968071F, -0.005825311F, 0.008656356F, -0.010074692F, -0.04002861F, -0.000072112845F, -0.0051499126F, 0.011988321F, -0.037777282F, -0.005754957F, -0.031968854F, -0.006326231F, -0.020577136F, 0.021297561F, 0.0023751508F, 0.006106727F, 0.041244328F, 0.007496922F, 0.019316394F, 0.016884958F, -0.021466412F, 0.0077220546F, 0.023526376F, -0.02856935F, -0.0013803454F, -0.039038025F, -0.0073168157F, 0.019113773F, 0.022592075F, -0.012022091F, -0.018550942F, 0.024989739F, 0.050699905F, 0.011932038F, 0.009084108F, 0.01825827F, 0.016153278F, 0.030190306F, -0.025102306F, 0.0033601068F, -0.0041114874F, 0.01637841F, 0.008661984F, 0.026610695F, 0.036246378F, 0.00951186F, -0.016457208F, 0.023909101F, -0.020554623F, 0.02173657F, 0.007198621F, -0.037709743F, 0.04588206F, 0.040839087F, -0.047548044F, -0.017065065F, 0.03784482F, -0.036336433F, -0.014183366F, 0.020745987F, -0.013789383F, -0.0052343374F, 0.022378199F, 0.013440427F, -0.015117667F, 0.010069064F, 0.005144284F, 0.008740781F, -0.043923408F, 0.0022231862F, 0.03397254F, -0.018539686F, -0.004525169F, 0.018607225F, 0.028321704F, -0.012584923F, -0.012247223F, 0.011160958F, 0.009275471F, -0.0021556464F, -0.020194411F, 0.03680921F, 0.032441635F, 0.049664292F, -0.008802692F, 0.056418277F, -0.012990162F, -0.022929775F, -0.0005417258F, 0.0016631684F, -0.007975329F, -0.001056717F, 0.0045701955F, 0.022333173F, 0.002287912F, -0.007114196F, 0.025147332F, -0.025845245F, -0.010294197F, 0.017729208F, -0.03467045F, 0.0025454075F, -0.012686232F, -0.0023456023F, 0.04840355F, 0.0019614694F, 0.014149596F, -0.0015562304F, 0.00760386F, 0.020509597F, -0.013091472F, -0.053716682F, 0.026318023F, -0.015669242F, 0.005161169F, -0.005349718F, 0.021162482F, -0.0023132393F, 0.009022197F, 0.011296038F, 0.013125242F, 0.02183788F, 0.035616007F, 0.007356214F, -0.024269314F, 0.021759083F, 0.0055523375F, 0.007975329F, -0.024044182F, 0.023233704F, 0.04002861F, -0.0063825147F, -0.026745776F, -0.01959781F, -0.031158378F, 0.022794696F, 0.011076533F, -0.025485031F, 0.0007232391F, 0.0009807347F, -0.01517395F, 0.017121349F, 0.0016251773F, 0.005051417F, 0.011386091F, -0.030798165F, 0.025530059F, -0.0015112038F, 0.035165742F, -0.0046799476F, -0.009917099F, 0.005366603F, 0.027286094F, -0.0134291705F, -0.006602019F, 0.0073505854F, -0.009483718F, -0.012348534F, 0.044891477F, 0.01835958F, 0.037236962F, -0.022108039F, 0.0042184256F, -0.03433275F, 0.016175792F, 0.03885792F, -0.020802269F, -0.0062812045F, -0.044396184F, 0.008988426F, 0.009236072F, -0.0044632573F, 0.028029032F, -0.04117679F, 0.013215294F, -0.009540002F, -0.009466833F, -0.030730626F, -0.046827618F, 0.010626268F, 0.02304234F, 0.010671294F, -0.0035430272F,
                        -0.039600857F, 0.03879038F, -0.0103786215F, -0.005966019F, -0.021173738F, 0.016130764F, 0.0022850977F, 0.0036724785F, 0.024742093F, 0.017774234F, 0.0045364257F, 0.04592709F, 0.007164851F, 0.0134179145F, 0.057949178F, -0.026520642F, -0.011419861F, -0.029559935F, -0.02739866F, -0.0068046385F, -0.009658197F, 0.012449843F, 0.0042184256F, -0.035886165F, 0.00077389396F, -0.007817736F, 0.010401134F, 0.005808426F, -0.0017574428F, 0.037034344F, 0.0106431525F, 0.026318023F, 0.00026435513F, -0.0077952226F, 0.012224711F, -0.0078683905F, -0.018911155F, -0.016873702F, 0.019958021F, -0.014307189F, 0.014262162F, 0.004502656F, 0.0050457884F, 0.026948394F, 0.028276678F, -0.019372676F, 0.047412965F, 0.023458837F, -0.0015097967F, 0.0012297878F, -0.000111950794F, 0.0034923723F, -0.009359895F, 0.002852151F, 0.03748461F, 0.0040073637F, 0.021049915F, 0.014971331F, 0.027173527F, -0.0038835406F, 0.022682128F, 0.008594444F, -0.014689914F, -0.01001278F, -0.010434905F, 0.010530586F, -0.0101197185F, 0.0059209922F, -0.012742516F, 0.02451696F, -0.023638943F, -0.026700748F, -0.018595967F,
                        -0.016299613F, -0.04189721F, 0.009005312F, -0.022366943F, 0.031045811F, 0.044846453F, -0.0027592836F, -0.005338461F, 0.028411757F, 0.0014035623F, 0.016794905F, 0.007677028F, 0.0056283195F, -0.005279364F, -0.03599873F, -0.0408616F, 0.01936142F, -0.0083974525F, -0.0027156642F, 0.026250483F, -0.010997737F, -0.055922985F, -0.019800428F, 0.010496817F, -0.024044182F, 0.011284781F, -0.02726358F, -0.044193566F, 0.021894164F, 0.010609383F, -0.016884958F, 0.05966019F, 0.008616958F, 0.032779332F, 0.026070377F, 0.01671611F, 0.010446161F, -0.011099046F, 0.012416073F, -0.023391297F, 0.025417492F, -0.0032419122F, -0.020419544F, -0.020160642F, 0.0067539834F, -0.012922622F, 0.009157276F, -0.001550602F, -0.014915047F, 0.0015604516F, 0.0049585495F, -0.014037029F, 0.027646307F, 0.0229748F, -0.0011453631F, 0.01229225F, 0.013992002F, 0.033319652F, 0.019248853F, -0.014149596F, 0.02555257F, -0.021320075F, 0.0054482133F, 0.042279936F, 0.017504074F, -0.019440217F, 0.022389455F, 0.016243331F, 0.039038025F, -0.00048227664F, -0.0095850285F, -0.021196252F, -0.0033854344F, -0.001602664F, -0.015432852F, -0.019170057F, -0.013350374F, 0.025755191F, 0.025980324F, -0.0018897083F, -0.0025228942F, -0.007733311F, 0.023503862F, 0.033184573F, -0.031766236F, 0.03413013F, 0.018629737F, 0.0021711243F, -0.01577055F, -0.017031295F, 0.02589027F, -0.018123189F, 0.004671505F, 0.020993633F, -0.00075419486F, 0.026205456F, -0.007164851F, -0.004142443F, -0.012551153F, -0.029132182F, -0.014037029F, 0.012202197F, -0.012033347F, -0.0048684967F, 0.045769494F, -0.03228404F, 0.050834984F, -0.05430203F, -0.007586975F, -0.0019248853F, -0.019732889F, 0.0041649565F, -0.0075025503F, 0.014194623F, 0.0006198187F, -0.025530059F, -0.026588183F, -0.047818203F, 0.058624577F, -0.0037766024F, 0.01898995F, -0.042392503F, -0.003346036F, -0.008481878F, 0.01781926F, -0.014566091F, 0.0008611329F, 0.047367938F, -0.02090358F, -0.044733886F, 0.015905632F, 0.0012396374F, 0.028029032F, -0.0053215763F, -0.032644253F, -0.006039187F, -0.008301771F, -0.008346798F, -0.02070096F, -0.010063436F, 0.0038441424F, -0.023031084F, 0.026723262F, 0.038317602F, 0.0030758767F, -0.023121137F, -0.018944925F, -0.04079406F, 0.02656567F, -0.0082680015F, 0.008087896F, -0.015050127F, 0.0067089573F, 0.008403081F, 0.06600893F, -0.047548044F, 0.007783966F, -0.038835406F, -0.011391719F, 0.02163526F, 0.0038300715F, 0.0072830454F, -0.04957424F, 0.028546838F, 0.0016814605F, -0.05033969F, -0.021184996F, 0.017706694F, -0.029582448F, 0.023864076F, 0.014419755F, 0.005296249F, 0.017965596F, 0.009900214F, -0.021770341F, 0.004826284F, -0.0019220712F, 0.00002482177F, -0.029289776F, -0.010052179F, -0.025485031F, -0.0484936F, -0.030122766F, -0.016704854F, 0.04311293F, -0.039871015F, -0.015725525F, -0.016006941F, 0.023774022F, 0.019654091F, 0.0278039F, 0.011538056F, 0.009292356F, -0.005566408F, -0.024336854F, -0.037552148F, 0.0041480716F, -0.04862868F, 0.032329068F, -0.025507545F, 0.018607225F, 0.019789172F, 0.00022900225F, -0.0150051005F, 0.025304925F, 0.027038448F, 0.010885171F, -0.015342799F, -0.025575085F, 0.003295381F, -0.0022836907F, -0.043833353F, 0.0049951337F, 0.018933667F, 0.010992108F, -0.03142854F, 0.017515332F, -0.0055832933F, -0.011864498F, -0.050789956F, 0.0011207392F, 0.05767902F, 0.034850556F, -0.0022119295F, -0.022063013F, -0.0022569562F, 0.03534585F, 0.0017391507F, 0.0024849032F, -0.021545207F, 0.01631087F, 0.003258797F, -0.0325542F, -0.015151436F, -0.014037029F, -0.011003365F, 0.038632788F, 0.06501835F, 0.01668234F, -0.014599862F, 0.014847508F, -0.0015196463F, -0.025665138F, -0.0053581605F, -0.02124128F, -0.02056588F, 0.04592709F, -0.0035430272F, 0.0007204249F, -0.08050749F, 0.0057915407F, 0.015342799F, 0.029357316F, -0.024134235F, 0.008932143F, -0.008104781F, 0.0085381605F, -0.015185206F, 0.018764818F, 0.016547259F, -0.025732677F, -0.009618798F, -0.02224312F, -0.023819048F, 0.0060504437F, -0.023706483F, -0.0020557437F, 0.015421595F, -0.0067089573F, 0.029920148F, 0.008757666F, 0.026318023F, -0.02478712F, 0.04786323F, -0.0023892217F, 0.043585707F, 0.023571402F, -0.009742621F, 0.0069847447F, -0.005932249F, 0.0070522847F, -0.013091472F, -0.0357736F, 0.025349952F, -0.011267896F, -0.040681496F, 0.029357316F, -0.0014070799F, -0.010333595F, -0.011363577F, 0.022186836F, -0.0014718056F, 0.009894586F, -0.007553205F, 0.0063600014F, 0.0015013543F, 0.0043197353F, 0.002183788F, -0.031833775F, 0.01922634F, 0.015342799F, 0.02348135F, -0.008566302F, -0.0068215234F, -0.0014872835F, -0.032329068F, 0.025440006F, -0.04646741F, 0.007221134F, -0.017402764F, 0.006427541F, -0.0008681683F, 0.04347314F, 0.01902372F, -0.014993844F, 0.017605385F, 0.009663825F, -0.026363049F, 0.011256639F, 0.011751931F, 0.0069284616F, 0.03541339F, 0.022986058F, 0.02478712F, 0.011464887F, 0.038542733F, -0.0010095799F, 0.012202197F,
                        -0.009106621F, 0.0002682246F);

              } else {
                // Magalie aime le bleu, et déteste le rouge.
                floatvector =  Arrays.asList(0.048675258F, 0.0055096764F, -0.009803577F, -0.034881722F, 0.010085416F, -0.00408114F, 0.0173856F, -0.045403715F, -0.06436982F, -0.0121025F, -0.037578538F, -0.045713186F, -0.009549369F, 0.0008434447F, -0.00009938625F, 0.03315753F, 0.008040702F, -0.04880789F, 0.006012566F, -0.002068201F, 0.0104446225F, 0.01047778F, -0.006974134F, 0.028360743F, 0.043878466F, 0.0027064835F, 0.036561705F, 0.021397661F, 0.029068103F, 0.0111188255F, 0.007068081F, -0.014478789F, 0.0011708754F, -0.04111534F, 0.0012820913F, -0.027012337F, 0.0015846537F, -0.0069299242F, 0.03015125F, -0.0035174615F, -0.036959596F, 0.028382847F, 0.054378353F, 0.027741803F, 0.024315523F, 0.01682192F, 0.00023883785F, 0.0058467784F, -0.009980417F, 0.025155514F, 0.0044458723F, 0.02712286F, -0.042397432F, 0.03174281F, -0.015915615F, -0.0055953334F, -0.044431094F, 0.026327081F, 0.028824948F, -0.019960834F, 0.004777448F, -0.0005422638F, -0.0029565466F, 0.0026774707F, -0.0042773215F, 0.0664919F, -0.023785003F, -0.057428844F, 0.0308144F, 0.019032424F, -0.03863958F, -0.031234395F, -0.0023514216F, 0.027233386F, 0.04208796F, -0.04414373F, 0.023851318F, 0.010295413F, -0.011925659F, -0.010643568F, -0.034218572F, -0.002381816F, 0.008134648F, -0.016600871F, 0.0072670258F, -0.035146985F, 0.03667223F, -0.033931207F, 0.003614171F, -0.008184385F, -0.0060015135F, -0.044851087F, -0.03587645F, -0.025686035F, -0.016214034F, 0.0075433385F, 0.0017062314F, -0.009654368F, -0.029974408F, 0.0008627866F, -0.006084407F, -0.022513965F, 0.01356143F, -0.0325828F, 0.02645971F, 0.012754598F, 0.04947104F, -0.013837744F, -0.014721944F, -0.06719927F, 0.042817425F, -0.031079661F, 0.021585554F, 0.020579776F, -0.021961339F, -0.008488328F, -0.016136665F, 0.023365008F, 0.03063756F, -0.05101839F, 0.034970146F, -0.010776198F, -0.019795047F, -0.0374238F, -0.054953083F, 0.03468278F, 0.025597615F, -0.003898773F, -0.044276357F, -0.019761888F, 0.010505412F, 0.009206741F, -0.012279339F, -0.019054528F, 0.0748476F, 0.06481192F, -0.0064215087F, -0.042132173F, -0.03914799F, 0.0259734F, -0.002964836F, 0.0031002292F, 0.017816648F, -0.009538317F, 0.025089199F, -0.019364F, -0.03824169F, 0.02126503F, 0.07268131F, -0.030527035F, 0.019905573F, -0.007294657F, 0.008725957F, -0.016070351F, -0.025155514F, -0.039545882F, 0.027144967F, -0.037534326F, 0.0131635405F, -0.015274569F, 0.03530172F, 0.03419647F, -0.00640493F, -0.04129218F, 0.005863357F, 0.033179637F, -0.043082688F, 0.01769507F, 0.055129923F, 0.017230865F, 0.026923915F, 0.029267048F, 0.07498023F, -0.015473515F, 0.021298189F, 0.046818435F, 0.0046807383F, 0.005606386F, 0.016479293F, 0.03090282F, -0.023387114F, 0.033909105F, 0.0067586103F, -0.01632456F, -0.02099977F, 0.0007260118F, -0.013948268F, -0.03059335F, -0.03707012F, -0.00541573F, 0.03090282F, 0.031367026F, 0.023453427F, -0.030836506F, -0.024293419F, 0.008460697F, 0.04907315F, 0.0044569247F, -0.09036533F, 0.0028460214F, 0.033577528F, 0.03068177F, 0.069409765F, -0.015517725F, 0.006106512F, 0.015816143F, 0.0148766795F, -0.031632286F, 0.0034677254F, 0.0005073793F, 0.06065618F, 0.044276357F, 0.032295436F, -0.005493098F, -0.00100716F, 0.014401422F, -0.014732997F, 0.01285407F, -0.018104013F, 0.036561705F, -0.06472351F, -0.013893006F, 0.018877689F, -0.031853337F, -0.074582346F, 0.019142948F, 0.04257427F, -0.048454206F, -0.037180647F, 0.008991217F, 0.04407741F, 0.0255313F, -0.021287136F, -0.034528043F, 0.015130887F, -0.022480806F, -0.039413255F, -0.020657143F, 0.01707613F, -0.020248199F, -0.026172346F, 0.061098278F, 0.022746067F, -0.053228892F, -0.03863958F, -0.012544599F, -0.038440634F, 0.017982434F, -0.022967117F, -0.0061120386F, 0.0070459754F, 0.06706663F, 0.009494106F, -0.017020866F, -0.032030176F, 0.054776244F, 0.021773446F, -0.027388122F, -0.034881722F, -0.04332584F, -0.042198487F, 0.010991722F, -0.000118641794F, -0.05278679F, 0.046730015F, 0.03707012F, -0.009123848F, -0.00842754F, -0.010113047F, 0.055527814F, -0.014246686F, -0.057782527F, -0.022082916F, 0.08678431F, 0.057561476F, -0.0032936481F, -0.0145340515F, -0.0005961448F, 0.046641596F, 0.0255313F, -0.022259757F, 0.046995275F, 0.00025196272F, -0.015959825F, 0.014368264F, 0.008212015F, -0.026304975F, 0.011190667F, 0.021585554F, 0.022071864F, 0.02482394F, -0.005531782F, -0.029863885F, 0.038971152F, -0.01087567F, -0.02707865F, 0.013119331F, 0.0074051823F, -0.03702591F, -0.005824673F, 0.009880944F, 0.055616233F, 0.06268984F, -0.009494106F, 0.029112313F, -0.029753359F, 0.0043574525F, -0.008245173F, -0.00081443187F, -0.011616189F, -0.005125602F, -0.005819147F, 0.0006780024F, -0.007930176F, 0.012312497F, -0.022768172F, 0.02712286F, 0.0023541849F, -0.034837514F, -0.043149002F, 0.0019949782F, 0.015130887F, 0.060037237F, -0.003981667F, -0.040010087F, -0.041137446F, -0.022116074F, -0.046818435F, 0.0035506191F, -0.030880716F, -0.033511214F, -0.04080587F, -0.0111077735F, -0.017905068F, 0.027564961F, -0.04907315F, -0.00092702935F, 0.029642833F, -0.05119523F, 0.0008904179F, 0.006322036F, -0.01615877F, -0.014489842F, -0.0059794085F, -0.025862874F, -0.03733538F, 0.027255492F, -0.016656134F, 0.03720275F, 0.01686613F, -0.042861637F, 0.0075433385F, -0.006620454F, -0.00084966177F, -0.018258749F, -0.047172114F, -0.01083146F, 0.020668196F, 0.008140174F, 0.037976425F, -0.035368033F, 0.022082916F, -0.066978216F, -0.005603623F, 0.03415226F, -0.055527814F, -0.022071864F, 0.024006054F, 0.011273561F, -0.031676497F, -0.010190415F, 0.06260142F, -0.05013419F, 0.01065462F, 0.04290585F, 0.017805595F, 0.0020087939F, 0.0029593098F, -0.027410226F, 0.0053079682F, 0.007139922F, -0.010140679F, 0.0075212335F, -0.036804862F, 0.015882459F, 0.0038794312F, -0.03218491F, -0.021298189F, 0.015550883F, 0.023674479F, -0.0019977414F, 0.03693749F, -0.02051346F, 0.015241412F, 0.021950286F, 0.014324054F, -0.015197203F, -0.00042552166F, -0.005741779F, 0.037136436F, 0.0063717724F, -0.040297452F, -0.06366246F, -0.033953313F, 0.023033433F, 0.018944003F, -0.0011681123F, 0.046906855F, -0.010046733F, -0.016578766F, 0.0142135285F, -0.00009247843F, 0.018115066F, 0.023055537F, -0.014909837F, 0.004896262F, -0.004393373F, 0.010074363F, -0.01924242F, 0.013528273F, 0.0603025F, 0.028117588F, 0.013484064F, -0.042507958F, 0.026172346F, 0.0070459754F, 0.002327935F, 0.03428489F, 0.045845814F, 0.013594588F, -0.038882732F, -0.010195941F, -0.008013071F, -0.011903554F, 0.0077091265F, 0.0038214056F, -0.052963633F, 0.00779202F, -0.02029241F, -0.0020032676F, 0.011892501F, -0.058357257F, 0.011229351F, 0.0152193075F, 0.025243934F, 0.011770924F, -0.006106512F, 0.001440971F, 0.0027382595F, -0.033002798F, -0.019518735F, 0.00013720656F, 0.0052831F, -0.018015593F, 0.022149231F, 0.024846043F, -0.046553176F, 0.031897545F, -0.016390873F, -0.027653381F, 0.012179866F, 0.02592919F, 0.0073443935F, 0.076439165F, -0.006896767F, 0.0018512956F, -0.038728F, -0.00023158464F, 0.024271313F, -0.03605329F, -0.028648108F, 0.043458473F, -0.017949278F, 0.009786998F, -0.016357716F, -0.0049929717F, -0.031499654F, 0.016390873F, 0.0059407246F, 0.05274258F, 0.032428067F, 0.040695343F, 0.008853061F, -0.0028101008F, -0.06631506F, -0.0033820684F, 0.018214537F, 0.0206903F, -0.046376336F, -0.02561972F, 0.047260538F, 0.0064159823F, -0.038794313F, -0.007488076F, -0.014500894F, 0.08240752F, -0.029885989F, -0.047658425F, -0.010234625F, -0.076262325F, 0.012312497F, 0.0016578767F, 0.0145229995F, 0.008714905F, 0.029112313F, -0.0062004584F, 0.022967117F, -0.045359503F, -0.0067862417F, 0.06436982F, 0.033511214F, -0.036650125F, 0.00622809F, -0.0016620213F, 0.0066978214F, -0.037556432F, 0.015683513F, 0.032140702F, -0.0060457233F, 0.022635542F, 0.015130887F, -0.016357716F, -0.017949278F, 0.0014534051F, 0.027144967F, 0.005059287F, 0.003332332F, -0.005758358F, 0.0009429173F, -0.01549562F, 0.007465971F, 0.004020351F, -0.034594357F, 0.028206008F, 0.009974891F, 0.004998498F, -0.037468012F, 0.022193441F, -0.00034210974F, -0.0169435F, 0.019297684F, -0.032361753F, 0.03947957F, 0.003995483F, -0.020767668F, -0.012257234F, -0.024293419F, 0.010544095F, 0.02161871F, 0.018568218F, 0.030460719F, 0.047570005F, -0.008422013F, -0.03578803F, 0.008140174F, 0.0121467095F, 0.029797569F, 0.01334038F, -0.021231873F, -0.00065658824F, -0.013738271F, -0.031720705F, -0.013307223F, 0.046774227F, 0.067729786F, -0.0051808646F, -0.02588498F, -0.059197247F, -0.020789772F, -0.017142445F, 0.014136162F, 0.025464986F, 0.022149231F, 0.0047719213F, -0.014810365F, -0.014931942F, 0.011914606F, 0.011312244F, 0.0025987215F, -0.017628755F, -0.03600908F, -0.01686613F, -0.031101765F, -0.006858083F, -0.00318036F, -0.0053079682F, 0.002445368F, -0.01787191F, 0.001786362F, -0.030261774F, -0.02482394F, -0.0013276829F, 0.0038628525F, 0.0043629785F, -0.008311488F, 0.004288374F, -0.0033903576F, 0.01329617F, 0.02232607F, 0.0049294196F, 0.030482825F, -0.038506947F, -0.00895806F, 0.016622975F, 0.035191193F, 0.007184132F, -0.012964595F, 0.0027631277F, -0.025686035F, 0.016092455F, 0.013893006F, 0.0025296435F, -0.006399404F, -0.04502793F, -0.0056146756F, 0.010057785F, 0.005957303F, -0.012389865F, -0.007421761F, -0.02557551F, -0.0073278146F, -0.033997525F, -0.01089225F, -0.039921667F, -0.0259734F, 0.0033903576F, 0.0019051766F, -0.017982434F, 0.016468242F, 0.0152303595F, 0.021298189F, -0.018501904F, 0.02175134F, -0.056058336F, 0.027984956F, 0.019076634F, -0.0014368264F, -0.001380873F, -0.015738776F, -0.0104446225F, 0.00045280755F, -0.0017020867F, -0.00045971537F, -0.028117588F, 0.023342902F, -0.0515047F, -0.008991217F, -0.002502012F, -0.0012620586F, 0.0044486355F, 0.024470259F, 0.018977161F, 0.0046890276F, -0.01853506F, -0.034992248F, 0.006382825F, 0.0497363F, -0.01087567F, 0.0054046777F, 0.02584077F, -0.0206903F, 0.003918115F, -0.017882962F, -0.017595597F, 0.0029620728F, -0.023121852F, -0.0131635405F, 0.009367003F, 0.014799312F, -0.0532731F, 0.054113094F, 0.03569961F, 0.034970146F, -0.005280337F, -0.03191965F, 0.009378055F, -0.004589555F, 0.010107521F, -0.009096216F, -0.021950286F, -0.0089027975F, -0.003094703F, -0.01632456F, -0.03218491F, -0.008654116F, 0.006277826F, -0.028139692F, 0.02038083F, 0.02095556F, 0.019684521F, -0.010698831F, 0.022569226F, -0.0325828F, -0.023630269F, 0.0063275625F, -0.0023983947F, -0.007919124F, 0.0067641367F, 0.041844804F, -0.047614217F, -0.00465587F, 0.0047304747F, 0.00649335F, 0.06021408F, 0.021121347F, -0.04471846F, 0.0046420544F, 0.008620959F, -0.035368033F, -0.0009636408F, -0.009516212F, -0.010809355F, -0.0053024422F, 0.027786013F, 0.015374042F, -0.016313506F, 0.010229099F, -0.0024716177F, -0.01558404F, 0.050089978F, -0.023851318F, 0.039899565F, -0.05185838F, -0.0036307499F, 0.03090282F, -0.021872919F, -0.0038849576F, -0.0037136436F, -0.024624994F, -0.022624489F, 0.016755607F, -0.0075599174F, -0.029642833F, -0.012190919F, -0.015329832F, -0.015473515F, 0.063927725F, 0.008527012F, 0.0046835016F, -0.027542857F, 0.03178702F, 0.011704609F, 0.013826691F, -0.05203522F, -0.040651135F, 0.027542857F, -0.01800454F, -0.026857601F, -0.068481356F, 0.028692318F, -0.011958817F, 0.006476771F, 0.001979781F, -0.0051642857F, -0.027299702F, -0.020944508F, -0.024470259F, -0.034528043F, -0.020016097F, -0.028360743F, 0.033356477F, 0.03552277F, -0.021762393F, 0.026570236F, 0.00972621F, -0.025641825F, 0.024890253F, -0.00649335F, 0.020215042F, 0.015882459F, 0.0013193935F, -0.03592066F, 0.0009733117F, -0.0025130645F, -0.013893006F, 0.018601375F, 0.02557551F, -0.024492364F, -0.008698326F, -0.01003568F, 0.010234625F, 0.027321806F, -0.010986196F, 0.0060291444F, 0.024050264F, -0.039280623F, 0.026769182F, -0.0308144F, -0.0055732285F, -0.03912589F, 0.03340069F, -0.03855116F, 0.041225865F, -0.0121025F, -0.016059298F, -0.013528273F, 0.017949278F, -0.0053079682F, 0.032450173F, 0.032140702F, -0.013484064F, -0.014125109F, 0.028117588F, 0.023939738F, 0.029090209F, -0.043569F, 0.026946021F, 0.03222912F, 0.02588498F, -0.016479293F, -0.003898773F, 0.035235405F, -0.0360975F, 0.031190185F, 0.020745562F, 0.028758632F, -0.00043346567F, 0.005802568F, -0.0012309734F, 0.018833479F, -0.011373034F, 0.026526026F, 0.009753841F, -0.006299931F, 0.015108782F, -0.0013560049F, 0.016711397F, -0.033378582F, 0.017584544F, 0.018126117F, 0.029090209F, 0.026791286F, -0.0037965374F, -0.00012183666F, 0.000019018089F, -0.00067662087F, 0.016125614F, -0.0030145722F, -0.000855188F, 0.018015593F, 0.0023901055F, 0.012201972F, -0.015539831F, -0.044762667F, 0.020126622F, -0.0050454712F, -0.0073443935F, -0.0050233663F, 0.04031956F, 0.0089138495F, -0.003285359F, -0.029753359F, -0.040209033F, -0.0065265074F, 0.0028211533F, -0.041623756F, 0.01849085F, -0.035677504F, 0.02042504F, -0.0030587823F, -0.0023873423F, -0.022746067F, -0.023851318F, 0.0064159823F, -0.017827699F, -0.017264022F, -0.0131745925F, -0.0040231138F, -0.0027921405F, 0.002366619F, -0.03231754F, -0.034992248F, 0.011892501F, -0.009985943F, -0.027366016F, -0.019993993F, 0.01818138F, 0.008753588F, 0.008311488F, -0.010118574F, -0.013594588F, -0.0021234637F, 0.009295162F, 0.029023893F, -0.03209649F, 0.0047995527F, -0.01065462F, -0.0071122907F, -0.033356477F, 0.013318275F, -0.032383855F, -0.016302453F, 0.014920889F, 0.00644914F, 0.021066086F, 0.022281861F, -0.021773446F, 0.023696583F, 0.028714422F, -0.012168814F, 0.021872919F, 0.009378055F, -0.045160558F, 0.0003978904F, -0.02240344F, -0.018634534F, -0.00020757997F, -0.013329328F, 0.054776244F, -0.06344141F, -0.008587801F, -0.024934465F, 0.012334602F, -0.022989223F, 0.016556662F, -0.004429294F, -0.048454206F, -0.024580784F, -0.0129867F, -0.010124099F, -0.005324547F, 0.03019546F, 0.004934946F, -0.010013575F, 0.013793534F, 0.0043602153F, 0.016390873F, 0.0064822976F, -0.0046669226F, 0.052477323F, 0.008289383F, 0.008112543F, -0.030748084F, -0.028029168F, 0.0347712F, -0.03315753F, 0.021762393F, 0.0022022128F, 0.02073451F, -0.026724972F, -0.01804875F, 0.00027648546F, 0.0019203738F, 0.061009858F, -0.004586792F, -0.027808117F, 0.0072393944F, -0.042729005F, 0.014313001F, 0.011881449F, 0.029775463F, 0.013749324F, -0.013826691F, -0.02126503F, -0.008891745F, 0.023298692F, -0.04235322F, 0.020845035F, -0.015462463F, 0.00083101064F, -0.034749094F, 0.001700705F, 0.0014326817F, 0.006299931F, -0.05212364F, -0.039192203F, 0.00050116226F, 0.0067144004F, -0.026614446F, 0.005957303F, -0.016125614F, -0.046376336F, 0.03439541F, 0.019187158F, -0.01778349F, -0.023033433F, 0.014942994F, -0.0028087192F, 0.00012580866F, -0.035058565F, 0.0049653403F, 0.0014741286F, -0.01509773F, 0.010953038F, -0.001061041F, -0.032914378F, -0.007626232F, -0.03267122F, -0.0038269318F, 0.03183123F, -0.009693052F, 0.044121623F, 0.021928182F, -0.0035754873F, 0.040209033F, 0.059197247F, 0.031322815F, -0.009245425F, 0.01818138F, -0.012533547F, -0.046111073F, 0.029090209F, -0.022812381F, 0.01303091F, -0.005324547F, -0.024448154F, -0.0048216577F, -0.059550926F, 0.0029289154F, -0.026702866F, -0.06193827F, 0.0037578538F, 0.044497408F, 0.036230132F, -0.022834487F, 0.009107268F, 0.011583031F, 0.014633524F, -0.00605125F, 0.02531025F, 0.025376564F, 0.022392387F, -0.012047237F, 0.012168814F, 0.023475533F, 0.021397661F, -0.011947764F, -0.008438592F, 0.033290163F, -0.011268035F, -0.044519514F, 0.018955056F, 0.0051007336F, 0.023541847F, 0.02015978F, 0.04275111F, 0.023099747F, -0.034594357F, -0.021331346F, -0.009875419F, -0.013970373F, -0.023232378F, 0.01276565F, 0.017949278F, 0.032074384F, -0.0020115569F, -0.029554414F, 0.014633524F, -0.00021224274F, 0.00029824508F, 0.013804586F, 0.019960834F, -0.031963862F, -0.05044366F, 0.011737767F, 0.016634028F, 0.013041963F, -0.0072559733F, 0.0063883513F, -0.0010568963F, -0.033002798F, -0.010057785F, -0.010306466F, 0.00035333497F, -0.001526628F, 0.046553176F, 0.020933455F, 0.026658656F, -0.028847054F, -0.041093234F, 0.011770924F, 0.0003778577F, 0.0054627033F, -0.020391881F, -0.015020362F, -0.00129867F, -0.008228594F, 0.00025334427F, 0.0100909425F, -0.010323045F, 0.0019189921F, -0.035986975F, 0.050178397F, 0.008897271F, -0.040164825F, -0.004890736F, 0.0365396F, 0.011892501F, -0.017065076F, 0.008140174F, 0.012522494F, -0.0011570597F, 0.0078085987F, 0.0044403463F, 0.014103004F, -0.024978675F, 0.009173584F, 0.004244164F, 0.029465994F, 0.022193441F, 0.0037219329F, -0.035942763F, 0.025067095F, -0.033201743F, -0.011384086F, 0.0097483145F, 0.018446641F, 0.014478789F, 0.0010410084F, 0.0024909596F, -0.00092150306F, -0.0030891767F, -0.039545882F, 0.037401695F, 0.0035008828F, -0.010897775F, 0.013959321F, -0.00035402575F, 0.027719697F, 0.011980922F, 0.03494804F, -0.002854311F, 0.026747076F, -0.038374316F, 0.0060733547F, -0.026614446F, -0.01236776F, -0.013329328F, 0.0065872963F, 0.0018913609F, 0.009389108F, 0.039634302F, -0.019562945F, -0.00013504787F, 0.012312497F, -0.009427791F, -0.02531025F, -0.012732493F, 0.0063054576F, -0.030792294F, 0.028559688F, 0.013649851F, -0.011560926F, 0.036031187F, 0.007073607F, -0.042972162F, 0.015418253F, 0.057428844F, -0.029598624F, 0.0031720705F, 0.017120339F, -0.0013794915F, -0.003832458F, -0.010251204F, 0.028581792F, 0.03134492F, -0.0009512067F, 0.021673974F, 0.00093670026F, 0.03702591F, -0.024536574F, 0.042972162F, 0.0075820223F, 0.021574501F, 0.013053015F, -0.018944003F, 0.010638041F, -0.037291173F, -0.030703874F, -0.019308737F, -0.013904058F, -0.0072338684F, -0.013992478F, 0.037534326F, -0.032516487F, -0.058401465F, 0.0111077735F, -0.002714773F, -0.010394886F, -0.0009449897F, 0.021629764F, -0.034903828F, -0.016788764F, 0.04129218F, 0.0018982687F, 0.018524008F, -0.004321532F, 0.003006283F, 0.008178858F, -0.00878122F, 0.033422794F, 0.034881722F, 0.032803852F, 0.004136402F, -0.0012337365F, 0.013395643F, 0.028272323F, 0.026327081F, -0.009869892F, -0.030173354F, -0.023785003F, 0.013428801F, 0.041712176F, 0.020856088F, 0.012201972F, 0.008350172F, -0.012268287F, -0.0077533363F, 0.0027327333F, 0.029797569F, 0.005120076F, -0.0030311511F, 0.0029593098F, 0.022436596F, -0.0057915156F, -0.008527012F, 0.001076929F, -0.0037771955F, 0.004948762F, -0.008200963F, -0.007095712F, -0.015241412F, 0.024890253F, 0.013749324F, -0.038109057F, -0.007145448F, -0.024050264F, -0.013782481F, -0.007294657F, -0.026857601F, -0.020767668F, -0.028758632F, 0.025597615F, 0.0027216808F, -0.0061175646F, 0.01285407F, -0.00963779F, 0.041579545F, -0.037357487F, -0.023851318F, -0.043060582F, -0.008797798F, 0.0001050852F, -0.01329617F, 0.024470259F, 0.036230132F, 0.0003854563F, -0.0022408965F, -0.003310227F, -0.04341426F, 0.024050264F, 0.015296675F, 0.024116578F, -0.01589351F, 0.005797042F, -0.010533043F, -0.009245425F, -0.016136665F, -0.011870396F, 0.008698326F, 0.023630269F, -0.012699335F, -0.0020764905F, 0.012644072F, -0.014478789F, -0.02584077F, -0.019673469F, -0.011417244F, 0.03534593F, 0.029355468F, 0.03041651F, 0.012224077F, 0.03161018F, -0.008980165F, 0.018037697F, -0.010416991F, -0.019165054F, -0.026791286F, -0.0022989223F, 0.027587067F, -0.031764917F, -0.0352133F, -0.014069846F, 0.028294427F, 0.019098738F, 0.018977161F, 0.00618388F, 0.02557551F, 0.033997525F, 0.0050786287F, 0.025730245F, 0.010510937F, -0.009925155F, 0.021861866F, 0.020413987F, -0.019485576F, 0.013008805F, 0.008521486F, 0.036561705F, -0.047746845F, -0.004584029F, 0.01087567F, -0.017142445F, 0.014666682F, -0.004244164F, 0.026481817F, 0.03419647F, -0.013086173F, 0.008466223F, 0.0052941525F, 0.00050634315F, -0.013550378F, -0.030261774F, 0.035589084F, -0.00061617745F, 0.014257739F, -0.01637982F, -0.015020362F, 0.011174088F, 0.000047448084F, 0.0090741115F, 0.0006876734F, -0.02668076F, 0.027410226F, 0.040164825F, 0.07276973F, 0.011339876F, 0.012434075F, -0.06680138F, 0.016689291F, 0.0073057096F, -0.013108278F, 0.0061783534F, -0.012555652F, -0.0062446687F, 0.019596102F, -0.004564687F, -0.05022261F, 0.0015915616F, -0.03556698F, 0.0029897043F, -0.03556698F, 0.03249438F, 0.021685027F, 0.00605125F, 0.02615024F, 0.017418757F, -0.033953313F, -0.0010306466F, 0.049692087F, 0.021718184F, -0.039103784F, -0.026349185F, 0.022049759F, 0.007687021F, 0.0052084955F, -0.02240344F, -0.022812381F, -0.003028388F, -0.0070238705F, 0.04248585F, -0.005197443F, -0.02663655F, -0.005363231F, 0.023696583F, 0.0369817F, -0.0038435105F, -0.005412967F, -0.024205F, -0.010466727F, -0.008460697F, -0.0024785255F, 0.033290163F, -0.00765939F, -0.017363494F, 0.021010824F, 0.005802568F, 0.010709883F, 0.05088576F, 0.0004818204F, -0.010582779F, 0.05972777F, -0.00408114F, -0.011268035F, 0.005841252F, -0.019386103F, -0.0036528548F, -0.03209649F, 0.02615024F, -0.044099517F, -0.010698831F, -0.031588078F, 0.006841504F, -0.05234469F, -0.012621967F, -0.009184636F, 0.019739784F, 0.009610158F, -0.0158493F, 0.021441871F, 0.03273754F, 0.025288144F, -0.046730015F, -0.013218802F, 0.0074328133F, -0.0025918137F, 0.012566704F, 0.030217564F, 0.0018457694F, 0.049603667F, -0.01007989F, 0.0031831232F, 0.0011418625F, -0.012069342F, -0.0011840002F, 0.028095482F, 0.008040702F, -0.016258243F, 0.0034953565F, -0.004954288F, -0.023254482F, 0.0011024879F, 0.014401422F, -0.006730979F, -0.003227333F, -0.00847175F, 0.009035427F, 0.03094703F, 0.016689291F, -0.026769182F, -0.007681495F, -0.006283352F, -0.036871176F, -0.02232607F, 0.01562825F, -0.020436093F, -0.013881953F, 0.0105662F, -0.03218491F, 0.0037606168F, -0.014445632F, 0.01884453F, 0.029377574F, -0.010405939F, -0.027034441F, -0.02055767F, -0.00280043F, -0.011135405F, -0.0076980735F, 0.035146985F, -0.010074363F, 0.038219582F, 0.020436093F, 0.020856088F, 0.019032424F, -0.017109286F, -0.020049255F, 0.020270305F, 0.018280853F, -0.01320775F, -0.03371016F, 0.03273754F, 0.007057028F, 0.017042972F, -0.029134419F, 0.030084934F, 0.010284361F, -0.015904563F, -0.014268791F, 0.002109648F, -0.031676497F, -0.07856125F, 0.024381839F, -0.016401926F, 0.019651365F, 0.07988755F, 0.005446125F, 0.0035754873F, -0.0057141483F, 0.015473515F, -0.017109286F, -0.028051272F, 0.0365396F, 0.009101743F, 0.004976393F, -0.02654813F, 0.011704609F, -0.021696078F, 0.020889245F, 0.027144967F, 0.018159276F, 0.032162808F, 0.026857601F, 0.043171108F, 0.019872414F, 0.023166062F, -0.0030974662F, 0.026791286F, -0.031499654F, -0.0055428343F, 0.0025987215F, 0.015639303F, 0.017230865F, 0.0019632021F, -0.00082341203F, 0.0071012382F, -0.0028515477F, 0.036738545F, -0.02544288F, 0.0063717724F, 0.012400917F, -0.011251456F, 0.0044569247F, -0.023497637F, 0.02716707F, -0.00025317157F, -0.0023901055F, 0.02539867F, -0.03406384F, -0.004934946F, -0.03614171F, 0.005545597F, -0.022082916F, -0.004009298F, -0.020833982F, -0.01483247F, -0.035412244F, 0.0020378067F, -0.0069078193F, 0.016556662F, -0.017827699F, -0.00013781099F, 0.025155514F, 0.04938262F, 0.008698326F, -0.00056367804F);

              }
              //List<Float> floatvector2 =  Arrays.asList(0.0014664384F, 0.05960067F,-0.061771914f);
              String id = parentId + "_" + chunks.indexOf(chunk);
              vectorDocument.removeField("id");
              vectorDocument.setField("id", id);
              vectorDocument.removeField("content_en");
              vectorDocument.removeField("content_fr");
            //  vectorDocument.removeField("exactContent");
              vectorDocument.addField("vector_1536", floatvector);
//              vectorDocument.addField("vector_4", floatvector2);
              //vectorDocument.addField(vectorField, floatvector);
              vectorDocument.addField("parent_doc", parentId);
            //  vectorDocument.addField("exactContent", chunk.text());
              vectorDocument.addField("content", chunk.text());

              // URL
              String url;
              if (parentDoc.containsKey("url")) {
                url = (String) parentDoc.getFieldValue("url");
                vectorDocument.addField("url", url);
              } else {
                url = (String) parentDoc.getFieldValue("id");
                vectorDocument.addField("url", url);
              }

              // TITLES
              if (parentDoc.getFieldValue("ignored_dc_title") != null) {
                parentDoc.getFieldValues("ignored_dc_title").forEach(value ->
                        vectorDocument.addField("title", value));
              }

              // keep the jsoup or filename as the first title for the searchView of Datafari
              String jsouptitle = "";
              String filename = "";
              if (parentDoc.getField("jsoup_title") != null) {
                jsouptitle = (String) parentDoc.getFieldValue("jsoup_title");
              }

              final SolrInputField streamNameField = parentDoc.get("ignored_stream_name");
              if (streamNameField != null && !streamNameField.getFirstValue().toString().isEmpty() && !streamNameField.getFirstValue().toString().toLowerCase().contentEquals("docname")) {
                filename = (String) streamNameField.getFirstValue();
              } else {
                final Pattern pattern = Pattern.compile("[^/]*$");
                final Matcher matcher = pattern.matcher(url);
                if (matcher.find()) {
                  filename = matcher.group();
                }
              }
              if (!jsouptitle.isEmpty()) {
                vectorDocument.addField("title", jsouptitle);
              } else if (!filename.isEmpty()) {
                vectorDocument.addField("title", filename);
              }
              // The title field has lost its original value(s) after the LangDetectLanguageIdentifierUpdateProcessorFactory
              // Need to set it back from the exactTitle field
              if (parentDoc.get("exactTitle") != null) {
                for (final Object value : parentDoc.getFieldValues("exactTitle")) {
                  vectorDocument.addField("title", value);
                }
              }

              try {
                client.add(vectorDocument);
                client.commit();
              } catch (SolrServerException e) {
                LOGGER.warn("Warning : the document associated to the chunk {} could not be added.", id);
              }
            }
          } else {
            LOGGER.warn("The file {} appears to be empty and has been ignored during vector embeddings.", parentDoc.get("id").getValue());
          }
        }

      }



      // VERY IMPORTANT ! without this line of code any other Update Processor declared AFTER this one in the conf WILL NOT EXECUTE
      super.processAdd(cmd);
    }
  }

  @Override
  public void processDelete(DeleteUpdateCommand cmd) throws IOException {
    final String id = cmd.getId();
    deleteExistingChildren(id);
    super.processDelete(cmd);
  }

  /**
   * Delete all the children of the parent document in VectorMain collection
   * @param parentId : The ID of the parent
   */
  private void deleteExistingChildren(String parentId) {
    try {
      client.deleteByQuery("parent_doc:\"" + parentId + "\"");
      client.commit();
    } catch (SolrServerException|IOException e) {
      LOGGER.error("Could not delete existing children for this document");
    }
  }

  /**
   *
   * @param content : The text content to embbed
   * @return The generated vector
   */
  private List<Float> vectorEmbeddings(String content) {
    // TODO : This method should be edited to implement the Solr Embeddings Model
/*
    SolrEmbeddingModel embedder = modelStore.getModel(embeddingModelName);
    float[] vectorToSearch = embedder.vectorise(qstr);*/


    /*
    List<Float> vector = new ArrayList<>();
    for (float f : vectorToSearch) {
      vector.add(f);
    }*/
    List<Float> vector = Arrays.asList(0.25f , -0.1F, 0.7F, -0.1f);

    return vector;
  }

}
